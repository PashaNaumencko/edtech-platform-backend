#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("source-map-support/register");
const cdk = require("aws-cdk-lib");
const network_stack_1 = require("../lib/stacks/network-stack");
const shared_services_stack_1 = require("../lib/stacks/shared-services-stack");
const user_service_stack_1 = require("../lib/stacks/user-service-stack");
const appsync_basic_stack_1 = require("../lib/stacks/appsync-basic-stack");
// import { AppSyncStack } from '../lib/stacks/appsync-stack';
// import { AppSyncStack } from '../lib/stacks/appsync-stack';
const app = new cdk.App();
// Get environment from context
const environment = app.node.tryGetContext('environment') || 'development';
// Common tags for all resources
const commonTags = {
    Project: 'EdTech-Platform',
    Environment: environment,
    ManagedBy: 'CDK',
    Owner: 'Platform-Team'
};
// Environment-specific configuration
const config = {
    development: {
        env: {
            account: process.env.CDK_DEFAULT_ACCOUNT,
            region: process.env.CDK_DEFAULT_REGION || 'us-east-1'
        },
        stackNamePrefix: 'EdTech-Dev'
    },
    production: {
        env: {
            account: process.env.CDK_DEFAULT_ACCOUNT,
            region: process.env.CDK_DEFAULT_REGION || 'us-east-1'
        },
        stackNamePrefix: 'EdTech-Prod'
    }
};
const currentConfig = config[environment];
// Network Foundation Stack
const networkStack = new network_stack_1.NetworkStack(app, `${currentConfig.stackNamePrefix}-Network`, {
    env: currentConfig.env,
    tags: commonTags,
    environment
});
// Shared Services Stack (depends on network)
const sharedServicesStack = new shared_services_stack_1.SharedServicesStack(app, `${currentConfig.stackNamePrefix}-SharedServices`, {
    env: currentConfig.env,
    tags: commonTags,
    environment,
    vpc: networkStack.vpc
});
// User Service Stack (depends on network and shared services)
const userServiceStack = new user_service_stack_1.UserServiceStack(app, `${currentConfig.stackNamePrefix}-UserService`, {
    env: currentConfig.env,
    tags: commonTags,
    environment,
    vpc: networkStack.vpc,
    userPool: sharedServicesStack.userPool,
    eventBus: sharedServicesStack.eventBus,
    contentBucket: sharedServicesStack.contentBucket
});
// AppSync Basic Stack (Day 2 completion - Cognito ready for AppSync)
const appSyncStack = new appsync_basic_stack_1.AppSyncBasicStack(app, `${currentConfig.stackNamePrefix}-AppSync`, {
    env: currentConfig.env,
    tags: commonTags,
    environment,
    vpc: networkStack.vpc,
    userPool: sharedServicesStack.userPool,
    userPoolClient: sharedServicesStack.userPoolClient
});
// AppSync Stack (commented out until schema definition issues are resolved)
// const appSyncStack = new AppSyncStack(app, `${currentConfig.stackNamePrefix}-AppSync`, {
//   env: currentConfig.env,
//   tags: commonTags,
//   environment,
//   vpc: networkStack.vpc,
//   userPool: sharedServicesStack.userPool,
//   userPoolClient: sharedServicesStack.userPoolClient
// });
// Add dependencies
sharedServicesStack.addDependency(networkStack);
userServiceStack.addDependency(networkStack);
userServiceStack.addDependency(sharedServicesStack);
appSyncStack.addDependency(sharedServicesStack);
// appSyncStack.addDependency(sharedServicesStack); 
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLHVDQUFxQztBQUNyQyxtQ0FBbUM7QUFDbkMsK0RBQTJEO0FBQzNELCtFQUEwRTtBQUMxRSx5RUFBb0U7QUFDcEUsMkVBQXNFO0FBQ3RFLDhEQUE4RDtBQUM5RCw4REFBOEQ7QUFFOUQsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7QUFFMUIsK0JBQStCO0FBQy9CLE1BQU0sV0FBVyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxJQUFJLGFBQWEsQ0FBQztBQUUzRSxnQ0FBZ0M7QUFDaEMsTUFBTSxVQUFVLEdBQUc7SUFDakIsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsV0FBVztJQUN4QixTQUFTLEVBQUUsS0FBSztJQUNoQixLQUFLLEVBQUUsZUFBZTtDQUN2QixDQUFDO0FBRUYscUNBQXFDO0FBQ3JDLE1BQU0sTUFBTSxHQUFHO0lBQ2IsV0FBVyxFQUFFO1FBQ1gsR0FBRyxFQUFFO1lBQ0gsT0FBTyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CO1lBQ3hDLE1BQU0sRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixJQUFJLFdBQVc7U0FDdEQ7UUFDRCxlQUFlLEVBQUUsWUFBWTtLQUM5QjtJQUNELFVBQVUsRUFBRTtRQUNWLEdBQUcsRUFBRTtZQUNILE9BQU8sRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQjtZQUN4QyxNQUFNLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsSUFBSSxXQUFXO1NBQ3REO1FBQ0QsZUFBZSxFQUFFLGFBQWE7S0FDL0I7Q0FDRixDQUFDO0FBRUYsTUFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLFdBQWtDLENBQUMsQ0FBQztBQUVqRSwyQkFBMkI7QUFDM0IsTUFBTSxZQUFZLEdBQUcsSUFBSSw0QkFBWSxDQUFDLEdBQUcsRUFBRSxHQUFHLGFBQWEsQ0FBQyxlQUFlLFVBQVUsRUFBRTtJQUNyRixHQUFHLEVBQUUsYUFBYSxDQUFDLEdBQUc7SUFDdEIsSUFBSSxFQUFFLFVBQVU7SUFDaEIsV0FBVztDQUNaLENBQUMsQ0FBQztBQUVILDZDQUE2QztBQUM3QyxNQUFNLG1CQUFtQixHQUFHLElBQUksMkNBQW1CLENBQUMsR0FBRyxFQUFFLEdBQUcsYUFBYSxDQUFDLGVBQWUsaUJBQWlCLEVBQUU7SUFDMUcsR0FBRyxFQUFFLGFBQWEsQ0FBQyxHQUFHO0lBQ3RCLElBQUksRUFBRSxVQUFVO0lBQ2hCLFdBQVc7SUFDWCxHQUFHLEVBQUUsWUFBWSxDQUFDLEdBQUc7Q0FDdEIsQ0FBQyxDQUFDO0FBRUgsOERBQThEO0FBQzlELE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxxQ0FBZ0IsQ0FBQyxHQUFHLEVBQUUsR0FBRyxhQUFhLENBQUMsZUFBZSxjQUFjLEVBQUU7SUFDakcsR0FBRyxFQUFFLGFBQWEsQ0FBQyxHQUFHO0lBQ3RCLElBQUksRUFBRSxVQUFVO0lBQ2hCLFdBQVc7SUFDWCxHQUFHLEVBQUUsWUFBWSxDQUFDLEdBQUc7SUFDckIsUUFBUSxFQUFFLG1CQUFtQixDQUFDLFFBQVE7SUFDdEMsUUFBUSxFQUFFLG1CQUFtQixDQUFDLFFBQVE7SUFDdEMsYUFBYSxFQUFFLG1CQUFtQixDQUFDLGFBQWE7Q0FDakQsQ0FBQyxDQUFDO0FBRUgscUVBQXFFO0FBQ3JFLE1BQU0sWUFBWSxHQUFHLElBQUksdUNBQWlCLENBQUMsR0FBRyxFQUFFLEdBQUcsYUFBYSxDQUFDLGVBQWUsVUFBVSxFQUFFO0lBQzFGLEdBQUcsRUFBRSxhQUFhLENBQUMsR0FBRztJQUN0QixJQUFJLEVBQUUsVUFBVTtJQUNoQixXQUFXO0lBQ1gsR0FBRyxFQUFFLFlBQVksQ0FBQyxHQUFHO0lBQ3JCLFFBQVEsRUFBRSxtQkFBbUIsQ0FBQyxRQUFRO0lBQ3RDLGNBQWMsRUFBRSxtQkFBbUIsQ0FBQyxjQUFjO0NBQ25ELENBQUMsQ0FBQztBQUVILDRFQUE0RTtBQUM1RSwyRkFBMkY7QUFDM0YsNEJBQTRCO0FBQzVCLHNCQUFzQjtBQUN0QixpQkFBaUI7QUFDakIsMkJBQTJCO0FBQzNCLDRDQUE0QztBQUM1Qyx1REFBdUQ7QUFDdkQsTUFBTTtBQUVOLG1CQUFtQjtBQUNuQixtQkFBbUIsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDaEQsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQzdDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBQ3BELFlBQVksQ0FBQyxhQUFhLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUNoRCxvREFBb0QiLCJzb3VyY2VzQ29udGVudCI6WyIjIS91c3IvYmluL2VudiBub2RlXG5pbXBvcnQgJ3NvdXJjZS1tYXAtc3VwcG9ydC9yZWdpc3Rlcic7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0IHsgTmV0d29ya1N0YWNrIH0gZnJvbSAnLi4vbGliL3N0YWNrcy9uZXR3b3JrLXN0YWNrJztcbmltcG9ydCB7IFNoYXJlZFNlcnZpY2VzU3RhY2sgfSBmcm9tICcuLi9saWIvc3RhY2tzL3NoYXJlZC1zZXJ2aWNlcy1zdGFjayc7XG5pbXBvcnQgeyBVc2VyU2VydmljZVN0YWNrIH0gZnJvbSAnLi4vbGliL3N0YWNrcy91c2VyLXNlcnZpY2Utc3RhY2snO1xuaW1wb3J0IHsgQXBwU3luY0Jhc2ljU3RhY2sgfSBmcm9tICcuLi9saWIvc3RhY2tzL2FwcHN5bmMtYmFzaWMtc3RhY2snO1xuLy8gaW1wb3J0IHsgQXBwU3luY1N0YWNrIH0gZnJvbSAnLi4vbGliL3N0YWNrcy9hcHBzeW5jLXN0YWNrJztcbi8vIGltcG9ydCB7IEFwcFN5bmNTdGFjayB9IGZyb20gJy4uL2xpYi9zdGFja3MvYXBwc3luYy1zdGFjayc7XG5cbmNvbnN0IGFwcCA9IG5ldyBjZGsuQXBwKCk7XG5cbi8vIEdldCBlbnZpcm9ubWVudCBmcm9tIGNvbnRleHRcbmNvbnN0IGVudmlyb25tZW50ID0gYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnZW52aXJvbm1lbnQnKSB8fCAnZGV2ZWxvcG1lbnQnO1xuXG4vLyBDb21tb24gdGFncyBmb3IgYWxsIHJlc291cmNlc1xuY29uc3QgY29tbW9uVGFncyA9IHtcbiAgUHJvamVjdDogJ0VkVGVjaC1QbGF0Zm9ybScsXG4gIEVudmlyb25tZW50OiBlbnZpcm9ubWVudCxcbiAgTWFuYWdlZEJ5OiAnQ0RLJyxcbiAgT3duZXI6ICdQbGF0Zm9ybS1UZWFtJ1xufTtcblxuLy8gRW52aXJvbm1lbnQtc3BlY2lmaWMgY29uZmlndXJhdGlvblxuY29uc3QgY29uZmlnID0ge1xuICBkZXZlbG9wbWVudDoge1xuICAgIGVudjoge1xuICAgICAgYWNjb3VudDogcHJvY2Vzcy5lbnYuQ0RLX0RFRkFVTFRfQUNDT1VOVCxcbiAgICAgIHJlZ2lvbjogcHJvY2Vzcy5lbnYuQ0RLX0RFRkFVTFRfUkVHSU9OIHx8ICd1cy1lYXN0LTEnXG4gICAgfSxcbiAgICBzdGFja05hbWVQcmVmaXg6ICdFZFRlY2gtRGV2J1xuICB9LFxuICBwcm9kdWN0aW9uOiB7XG4gICAgZW52OiB7XG4gICAgICBhY2NvdW50OiBwcm9jZXNzLmVudi5DREtfREVGQVVMVF9BQ0NPVU5ULFxuICAgICAgcmVnaW9uOiBwcm9jZXNzLmVudi5DREtfREVGQVVMVF9SRUdJT04gfHwgJ3VzLWVhc3QtMSdcbiAgICB9LFxuICAgIHN0YWNrTmFtZVByZWZpeDogJ0VkVGVjaC1Qcm9kJ1xuICB9XG59O1xuXG5jb25zdCBjdXJyZW50Q29uZmlnID0gY29uZmlnW2Vudmlyb25tZW50IGFzIGtleW9mIHR5cGVvZiBjb25maWddO1xuXG4vLyBOZXR3b3JrIEZvdW5kYXRpb24gU3RhY2tcbmNvbnN0IG5ldHdvcmtTdGFjayA9IG5ldyBOZXR3b3JrU3RhY2soYXBwLCBgJHtjdXJyZW50Q29uZmlnLnN0YWNrTmFtZVByZWZpeH0tTmV0d29ya2AsIHtcbiAgZW52OiBjdXJyZW50Q29uZmlnLmVudixcbiAgdGFnczogY29tbW9uVGFncyxcbiAgZW52aXJvbm1lbnRcbn0pO1xuXG4vLyBTaGFyZWQgU2VydmljZXMgU3RhY2sgKGRlcGVuZHMgb24gbmV0d29yaylcbmNvbnN0IHNoYXJlZFNlcnZpY2VzU3RhY2sgPSBuZXcgU2hhcmVkU2VydmljZXNTdGFjayhhcHAsIGAke2N1cnJlbnRDb25maWcuc3RhY2tOYW1lUHJlZml4fS1TaGFyZWRTZXJ2aWNlc2AsIHtcbiAgZW52OiBjdXJyZW50Q29uZmlnLmVudixcbiAgdGFnczogY29tbW9uVGFncyxcbiAgZW52aXJvbm1lbnQsXG4gIHZwYzogbmV0d29ya1N0YWNrLnZwY1xufSk7XG5cbi8vIFVzZXIgU2VydmljZSBTdGFjayAoZGVwZW5kcyBvbiBuZXR3b3JrIGFuZCBzaGFyZWQgc2VydmljZXMpXG5jb25zdCB1c2VyU2VydmljZVN0YWNrID0gbmV3IFVzZXJTZXJ2aWNlU3RhY2soYXBwLCBgJHtjdXJyZW50Q29uZmlnLnN0YWNrTmFtZVByZWZpeH0tVXNlclNlcnZpY2VgLCB7XG4gIGVudjogY3VycmVudENvbmZpZy5lbnYsXG4gIHRhZ3M6IGNvbW1vblRhZ3MsXG4gIGVudmlyb25tZW50LFxuICB2cGM6IG5ldHdvcmtTdGFjay52cGMsXG4gIHVzZXJQb29sOiBzaGFyZWRTZXJ2aWNlc1N0YWNrLnVzZXJQb29sLFxuICBldmVudEJ1czogc2hhcmVkU2VydmljZXNTdGFjay5ldmVudEJ1cyxcbiAgY29udGVudEJ1Y2tldDogc2hhcmVkU2VydmljZXNTdGFjay5jb250ZW50QnVja2V0XG59KTtcblxuLy8gQXBwU3luYyBCYXNpYyBTdGFjayAoRGF5IDIgY29tcGxldGlvbiAtIENvZ25pdG8gcmVhZHkgZm9yIEFwcFN5bmMpXG5jb25zdCBhcHBTeW5jU3RhY2sgPSBuZXcgQXBwU3luY0Jhc2ljU3RhY2soYXBwLCBgJHtjdXJyZW50Q29uZmlnLnN0YWNrTmFtZVByZWZpeH0tQXBwU3luY2AsIHtcbiAgZW52OiBjdXJyZW50Q29uZmlnLmVudixcbiAgdGFnczogY29tbW9uVGFncyxcbiAgZW52aXJvbm1lbnQsXG4gIHZwYzogbmV0d29ya1N0YWNrLnZwYyxcbiAgdXNlclBvb2w6IHNoYXJlZFNlcnZpY2VzU3RhY2sudXNlclBvb2wsXG4gIHVzZXJQb29sQ2xpZW50OiBzaGFyZWRTZXJ2aWNlc1N0YWNrLnVzZXJQb29sQ2xpZW50XG59KTtcblxuLy8gQXBwU3luYyBTdGFjayAoY29tbWVudGVkIG91dCB1bnRpbCBzY2hlbWEgZGVmaW5pdGlvbiBpc3N1ZXMgYXJlIHJlc29sdmVkKVxuLy8gY29uc3QgYXBwU3luY1N0YWNrID0gbmV3IEFwcFN5bmNTdGFjayhhcHAsIGAke2N1cnJlbnRDb25maWcuc3RhY2tOYW1lUHJlZml4fS1BcHBTeW5jYCwge1xuLy8gICBlbnY6IGN1cnJlbnRDb25maWcuZW52LFxuLy8gICB0YWdzOiBjb21tb25UYWdzLFxuLy8gICBlbnZpcm9ubWVudCxcbi8vICAgdnBjOiBuZXR3b3JrU3RhY2sudnBjLFxuLy8gICB1c2VyUG9vbDogc2hhcmVkU2VydmljZXNTdGFjay51c2VyUG9vbCxcbi8vICAgdXNlclBvb2xDbGllbnQ6IHNoYXJlZFNlcnZpY2VzU3RhY2sudXNlclBvb2xDbGllbnRcbi8vIH0pO1xuXG4vLyBBZGQgZGVwZW5kZW5jaWVzXG5zaGFyZWRTZXJ2aWNlc1N0YWNrLmFkZERlcGVuZGVuY3kobmV0d29ya1N0YWNrKTtcbnVzZXJTZXJ2aWNlU3RhY2suYWRkRGVwZW5kZW5jeShuZXR3b3JrU3RhY2spO1xudXNlclNlcnZpY2VTdGFjay5hZGREZXBlbmRlbmN5KHNoYXJlZFNlcnZpY2VzU3RhY2spO1xuYXBwU3luY1N0YWNrLmFkZERlcGVuZGVuY3koc2hhcmVkU2VydmljZXNTdGFjayk7XG4vLyBhcHBTeW5jU3RhY2suYWRkRGVwZW5kZW5jeShzaGFyZWRTZXJ2aWNlc1N0YWNrKTsgIl19