# API Documentation

Complete REST API documentation for the EdTech Platform backend microservices, including authentication, endpoints, request/response examples, and error handling.

## Table of Contents

- [Architecture Overview](#architecture-overview)
- [Authentication](#authentication)
- [Identity Service API](#identity-service-api)
- [User Service API](#user-service-api)
- [Tutor Service API](#tutor-service-api)
- [Admin Service API](#admin-service-api)
- [Error Responses](#error-responses)
- [API Versioning](#api-versioning)
- [Rate Limiting](#rate-limiting)

## Architecture Overview

### Dual-Port Pattern

Each service exposes **two separate HTTP servers** for public and internal communication:

```
Service          Public Port    Internal Port    Purpose
─────────────────────────────────────────────────────────────────────
User Service     3000           3001            Public: External clients
                                                Internal: Service-to-service

Tutor Service    3002           3003            Public: External clients
                                                Internal: Service-to-service

Admin Service    3004           3005            Public: Admin panel
                                                Internal: Service-to-service
```

### Port Configuration

**Public Ports (3000, 3002, 3004)**
- Exposed via Application Load Balancer (ALB)
- Protected by AWS Cognito JWT authentication
- CORS enabled for web clients
- Rate limited
- Logged and monitored

**Internal Ports (3001, 3003, 3005)**
- Only accessible within VPC private subnets
- Protected by service-to-service JWT tokens
- No CORS (not needed for backend communication)
- No rate limiting (trusted internal traffic)
- Path prefix: `/internal/`

### Base URLs

```bash
# Development (Local)
PUBLIC_USER_URL=http://localhost:3000
INTERNAL_USER_URL=http://localhost:3001

PUBLIC_TUTOR_URL=http://localhost:3002
INTERNAL_TUTOR_URL=http://localhost:3003

PUBLIC_ADMIN_URL=http://localhost:3004
INTERNAL_ADMIN_URL=http://localhost:3005

# Production (AWS)
PUBLIC_USER_URL=https://api.edtech.com/users
INTERNAL_USER_URL=http://user-service.internal:3001

PUBLIC_TUTOR_URL=https://api.edtech.com/tutors
INTERNAL_TUTOR_URL=http://tutor-service.internal:3003

PUBLIC_ADMIN_URL=https://api.edtech.com/admin
INTERNAL_ADMIN_URL=http://admin-service.internal:3005
```

## Authentication

### Public API Authentication (AWS Cognito)

All public API requests must include a valid JWT token from AWS Cognito.

#### Login Flow

```bash
# 1. User logs in via Cognito
curl -X POST https://cognito-idp.us-east-1.amazonaws.com/ \
  -H "Content-Type: application/x-amz-json-1.1" \
  -H "X-Amz-Target: AWSCognitoIdentityProviderService.InitiateAuth" \
  -d '{
    "AuthFlow": "USER_PASSWORD_AUTH",
    "ClientId": "YOUR_CLIENT_ID",
    "AuthParameters": {
      "USERNAME": "student@example.com",
      "PASSWORD": "SecurePassword123!"
    }
  }'

# Response:
{
  "AuthenticationResult": {
    "AccessToken": "eyJraWQiOiJ...",
    "IdToken": "eyJraWQiOiJ...",
    "RefreshToken": "eyJjdHk...",
    "ExpiresIn": 3600,
    "TokenType": "Bearer"
  }
}
```

#### Using JWT in API Requests

```bash
# Include IdToken in Authorization header
curl -X GET http://localhost:3000/users/me \
  -H "Authorization: Bearer eyJraWQiOiJ..."
```

#### JWT Token Structure

```json
{
  "sub": "user-id-123",
  "email": "student@example.com",
  "email_verified": true,
  "cognito:groups": ["students"],
  "cognito:username": "student@example.com",
  "aud": "client-id",
  "event_id": "event-id",
  "token_use": "id",
  "auth_time": 1699564800,
  "iss": "https://cognito-idp.us-east-1.amazonaws.com/us-east-1_XXXXX",
  "exp": 1699568400,
  "iat": 1699564800
}
```

### Internal API Authentication (Service Tokens)

Internal services use special JWT tokens generated by the `@edtech/service-auth` library.

```typescript
// Generate service token
import { ServiceAuthService } from '@edtech/service-auth';

const token = await serviceAuthService.generateToken({
  serviceId: 'user-service',
  serviceName: 'User Service',
});

// Use in inter-service calls
const response = await fetch('http://tutor-service.internal:3003/internal/tutors', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'X-Service-Name': 'user-service',
  },
});
```

## Identity Service API

**Not yet implemented** - Authentication is currently handled by AWS Cognito directly.

**Future endpoints**:
- `POST /register` - User registration
- `POST /login` - User login
- `POST /verify-email` - Email verification
- `POST /forgot-password` - Password reset request
- `POST /reset-password` - Password reset

## User Service API

**Base URL**: `http://localhost:3000` (Public) | `http://localhost:3001` (Internal)

### Public Endpoints

#### Get Current User Profile

```bash
GET /users/me
Authorization: Bearer {cognito_id_token}
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "user-123",
      "email": "student@example.com",
      "firstName": "John",
      "lastName": "Doe",
      "role": "student",
      "status": "active",
      "bio": "Mathematics enthusiast",
      "skills": ["algebra", "calculus"],
      "createdAt": "2025-11-01T10:00:00.000Z",
      "updatedAt": "2025-11-13T15:30:00.000Z"
    }
  }
}
```

#### Update Current User Profile

```bash
PUT /users/me
Authorization: Bearer {cognito_id_token}
Content-Type: application/json

{
  "firstName": "Jane",
  "lastName": "Smith",
  "bio": "Passionate about teaching mathematics",
  "skills": ["algebra", "geometry", "trigonometry"]
}
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "user-123",
      "email": "student@example.com",
      "firstName": "Jane",
      "lastName": "Smith",
      "role": "student",
      "status": "active",
      "bio": "Passionate about teaching mathematics",
      "skills": ["algebra", "geometry", "trigonometry"],
      "updatedAt": "2025-11-13T15:35:00.000Z"
    }
  }
}
```

#### Become a Tutor

```bash
POST /users/me/become-tutor
Authorization: Bearer {cognito_id_token}
Content-Type: application/json

{
  "subjects": ["mathematics", "physics"],
  "bio": "PhD in Mathematics with 10 years teaching experience"
}
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "user-123",
      "email": "teacher@example.com",
      "firstName": "Jane",
      "lastName": "Smith",
      "role": "tutor",
      "status": "active",
      "bio": "PhD in Mathematics with 10 years teaching experience",
      "skills": ["mathematics", "physics"]
    }
  },
  "message": "Successfully promoted to tutor"
}
```

### Internal Endpoints

These endpoints are only accessible from other services within the VPC.

#### Create User (Internal)

```bash
POST /internal/users
Authorization: Bearer {service_token}
X-Service-Name: identity-service
Content-Type: application/json

{
  "email": "newuser@example.com",
  "firstName": "Alice",
  "lastName": "Johnson",
  "role": "student",
  "status": "pending_verification"
}
```

**Response (201 Created)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "user-456",
      "email": "newuser@example.com",
      "firstName": "Alice",
      "lastName": "Johnson",
      "role": "student",
      "status": "pending_verification",
      "bio": null,
      "skills": [],
      "createdAt": "2025-11-13T16:00:00.000Z",
      "updatedAt": "2025-11-13T16:00:00.000Z"
    }
  }
}
```

#### Get User by ID (Internal)

```bash
GET /internal/users/{userId}
Authorization: Bearer {service_token}
X-Service-Name: tutor-service
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "user-456",
      "email": "newuser@example.com",
      "firstName": "Alice",
      "lastName": "Johnson",
      "role": "student",
      "status": "active",
      "bio": "Love learning new things",
      "skills": ["mathematics"]
    }
  }
}
```

#### Update User Profile (Internal)

```bash
PUT /internal/users/{userId}/profile
Authorization: Bearer {service_token}
X-Service-Name: admin-service
Content-Type: application/json

{
  "bio": "Updated biography",
  "skills": ["mathematics", "programming"]
}
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "user-456",
      "firstName": "Alice",
      "lastName": "Johnson",
      "bio": "Updated biography",
      "skills": ["mathematics", "programming"]
    }
  }
}
```

#### Get All Users (Internal)

```bash
GET /internal/users?limit=20&offset=0
Authorization: Bearer {service_token}
X-Service-Name: admin-service
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": "user-123",
        "email": "user1@example.com",
        "firstName": "John",
        "lastName": "Doe",
        "role": "student"
      },
      {
        "id": "user-456",
        "email": "user2@example.com",
        "firstName": "Jane",
        "lastName": "Smith",
        "role": "tutor"
      }
    ],
    "total": 45,
    "limit": 20,
    "offset": 0,
    "hasNext": true
  }
}
```

## Tutor Service API

**Base URL**: `http://localhost:3002` (Public) | `http://localhost:3003` (Internal)

### Public Endpoints

#### Get My Tutor Profile

```bash
GET /tutors/me
Authorization: Bearer {cognito_id_token}
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "tutor-789",
      "userId": "user-123",
      "verificationStatus": "approved",
      "subjects": ["mathematics", "physics"],
      "hourlyRate": 50.00,
      "bio": "PhD in Mathematics",
      "yearsOfExperience": 10,
      "education": [
        {
          "degree": "PhD",
          "field": "Mathematics",
          "institution": "MIT",
          "year": 2015
        }
      ],
      "certifications": [
        {
          "name": "Certified Math Teacher",
          "issuer": "State Board",
          "year": 2016
        }
      ],
      "availability": {
        "monday": ["09:00-17:00"],
        "tuesday": ["09:00-17:00"],
        "wednesday": ["09:00-17:00"]
      },
      "rating": 4.8,
      "totalSessions": 156,
      "createdAt": "2025-10-01T10:00:00.000Z"
    }
  }
}
```

#### Update Tutor Profile

```bash
PUT /tutors/me
Authorization: Bearer {cognito_id_token}
Content-Type: application/json

{
  "bio": "PhD in Mathematics with focus on algebra",
  "hourlyRate": 55.00,
  "subjects": ["mathematics", "physics", "programming"],
  "yearsOfExperience": 11
}
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "tutor-789",
      "bio": "PhD in Mathematics with focus on algebra",
      "hourlyRate": 55.00,
      "subjects": ["mathematics", "physics", "programming"],
      "yearsOfExperience": 11,
      "updatedAt": "2025-11-13T16:30:00.000Z"
    }
  }
}
```

#### Upload Tutor Document

```bash
POST /tutors/me/documents
Authorization: Bearer {cognito_id_token}
Content-Type: multipart/form-data

{
  "file": <certificate.pdf>,
  "documentType": "certification",
  "description": "Teaching Certification"
}
```

**Response (201 Created)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "doc-123",
      "tutorId": "tutor-789",
      "documentType": "certification",
      "description": "Teaching Certification",
      "fileName": "certificate.pdf",
      "fileSize": 245678,
      "s3Key": "tutors/tutor-789/documents/certificate-uuid.pdf",
      "uploadedAt": "2025-11-13T16:45:00.000Z",
      "verificationStatus": "pending"
    }
  }
}
```

#### Search Tutors

```bash
GET /tutors/search?subject=mathematics&minRating=4.5&maxRate=60&availability=monday
Authorization: Bearer {cognito_id_token}
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": "tutor-789",
        "userId": "user-123",
        "firstName": "Jane",
        "lastName": "Smith",
        "subjects": ["mathematics", "physics"],
        "hourlyRate": 55.00,
        "rating": 4.8,
        "totalSessions": 156,
        "availability": {
          "monday": ["09:00-17:00"]
        }
      }
    ],
    "total": 12,
    "limit": 10,
    "offset": 0
  }
}
```

### Internal Endpoints

#### Create Tutor Profile (Internal)

```bash
POST /internal/tutors
Authorization: Bearer {service_token}
X-Service-Name: user-service
Content-Type: application/json

{
  "userId": "user-123",
  "subjects": ["mathematics"],
  "hourlyRate": 50.00,
  "bio": "Experienced math teacher"
}
```

**Response (201 Created)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "tutor-999",
      "userId": "user-123",
      "subjects": ["mathematics"],
      "hourlyRate": 50.00,
      "bio": "Experienced math teacher",
      "verificationStatus": "pending",
      "createdAt": "2025-11-13T17:00:00.000Z"
    }
  }
}
```

#### Get Tutor by User ID (Internal)

```bash
GET /internal/tutors/by-user/{userId}
Authorization: Bearer {service_token}
X-Service-Name: matching-service
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "tutor-999",
      "userId": "user-123",
      "verificationStatus": "approved",
      "subjects": ["mathematics"],
      "hourlyRate": 50.00,
      "rating": 4.5,
      "totalSessions": 20
    }
  }
}
```

## Admin Service API

**Base URL**: `http://localhost:3004` (Public) | `http://localhost:3005` (Internal)

### Public Endpoints (Admin Panel)

#### Get Pending Verifications

```bash
GET /admin/verifications/pending?type=tutor
Authorization: Bearer {cognito_id_token}
X-Admin-Role: admin
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": "verification-123",
        "tutorId": "tutor-789",
        "userId": "user-123",
        "tutorName": "Jane Smith",
        "submittedAt": "2025-11-10T14:00:00.000Z",
        "documents": [
          {
            "id": "doc-456",
            "type": "certification",
            "fileName": "certificate.pdf",
            "s3Url": "https://s3.amazonaws.com/..."
          }
        ],
        "status": "pending"
      }
    ],
    "total": 8,
    "limit": 10,
    "offset": 0
  }
}
```

#### Approve Tutor Verification

```bash
POST /admin/verifications/{verificationId}/approve
Authorization: Bearer {cognito_id_token}
X-Admin-Role: admin
Content-Type: application/json

{
  "notes": "All documents verified successfully",
  "approvedDocuments": ["doc-456", "doc-457"]
}
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "verification-123",
      "tutorId": "tutor-789",
      "status": "approved",
      "approvedBy": "admin-001",
      "approvedAt": "2025-11-13T17:30:00.000Z",
      "notes": "All documents verified successfully"
    }
  },
  "message": "Tutor verification approved successfully"
}
```

#### Reject Tutor Verification

```bash
POST /admin/verifications/{verificationId}/reject
Authorization: Bearer {cognito_id_token}
X-Admin-Role: admin
Content-Type: application/json

{
  "reason": "Invalid certification document",
  "rejectedDocuments": ["doc-456"],
  "feedback": "Please upload a valid teaching certification from an accredited institution"
}
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "id": "verification-123",
      "tutorId": "tutor-789",
      "status": "rejected",
      "rejectedBy": "admin-001",
      "rejectedAt": "2025-11-13T17:35:00.000Z",
      "reason": "Invalid certification document",
      "feedback": "Please upload a valid teaching certification from an accredited institution"
    }
  },
  "message": "Tutor verification rejected"
}
```

#### Get Platform Analytics

```bash
GET /admin/analytics?startDate=2025-11-01&endDate=2025-11-13
Authorization: Bearer {cognito_id_token}
X-Admin-Role: admin
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "period": {
        "start": "2025-11-01",
        "end": "2025-11-13"
      },
      "users": {
        "total": 1234,
        "students": 1000,
        "tutors": 200,
        "admins": 34,
        "newRegistrations": 45
      },
      "tutors": {
        "pending": 8,
        "approved": 180,
        "rejected": 12,
        "averageApprovalTime": "2.5 days"
      },
      "sessions": {
        "total": 567,
        "completed": 540,
        "cancelled": 27,
        "averageRating": 4.6
      },
      "revenue": {
        "total": 28350.00,
        "platformFee": 5670.00,
        "tutorPayouts": 22680.00
      }
    }
  }
}
```

### Internal Endpoints

#### Update User Status (Internal)

```bash
PUT /internal/admin/users/{userId}/status
Authorization: Bearer {service_token}
X-Service-Name: admin-service
Content-Type: application/json

{
  "status": "suspended",
  "reason": "Terms of service violation",
  "suspendedUntil": "2025-12-13T00:00:00.000Z"
}
```

**Response (200 OK)**:
```json
{
  "success": true,
  "data": {
    "data": {
      "userId": "user-123",
      "status": "suspended",
      "reason": "Terms of service violation",
      "suspendedUntil": "2025-12-13T00:00:00.000Z",
      "updatedAt": "2025-11-13T18:00:00.000Z"
    }
  }
}
```

## Error Responses

All errors follow a consistent structure:

### Error Response Format

```json
{
  "success": false,
  "message": "Error summary message",
  "errors": [
    "Detailed error message 1",
    "Detailed error message 2"
  ],
  "timestamp": "2025-11-13T18:00:00.000Z",
  "path": "/users/me",
  "requestId": "req-uuid-123"
}
```

### HTTP Status Codes

| Code | Meaning              | Use Case                                    |
|------|----------------------|---------------------------------------------|
| 200  | OK                   | Successful GET, PUT, DELETE                 |
| 201  | Created              | Successful POST (resource created)          |
| 204  | No Content           | Successful DELETE (no response body)        |
| 400  | Bad Request          | Invalid request data, validation errors     |
| 401  | Unauthorized         | Missing or invalid authentication token     |
| 403  | Forbidden            | Authenticated but insufficient permissions  |
| 404  | Not Found            | Resource does not exist                     |
| 409  | Conflict             | Resource already exists (duplicate)         |
| 422  | Unprocessable Entity | Business logic validation failed            |
| 429  | Too Many Requests    | Rate limit exceeded                         |
| 500  | Internal Server Error| Unexpected server error                     |
| 503  | Service Unavailable  | Service is down or overloaded               |

### Common Error Examples

#### 400 Bad Request (Validation Error)

```json
{
  "success": false,
  "message": "Validation failed",
  "errors": [
    "email must be a valid email address",
    "firstName should not be empty",
    "hourlyRate must be a positive number"
  ],
  "timestamp": "2025-11-13T18:05:00.000Z",
  "path": "/internal/users",
  "requestId": "req-uuid-456"
}
```

**cURL Example**:
```bash
curl -X POST http://localhost:3001/internal/users \
  -H "Authorization: Bearer {service_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "invalid-email",
    "firstName": "",
    "lastName": "Doe"
  }'
# Response: 400 Bad Request with validation errors
```

#### 401 Unauthorized (Missing Token)

```json
{
  "success": false,
  "message": "Unauthorized",
  "errors": ["No authorization token provided"],
  "timestamp": "2025-11-13T18:10:00.000Z",
  "path": "/users/me"
}
```

**cURL Example**:
```bash
curl -X GET http://localhost:3000/users/me
# Response: 401 Unauthorized
```

#### 403 Forbidden (Insufficient Permissions)

```json
{
  "success": false,
  "message": "Forbidden",
  "errors": ["You do not have permission to access this resource"],
  "timestamp": "2025-11-13T18:15:00.000Z",
  "path": "/admin/verifications/pending"
}
```

**cURL Example**:
```bash
# Student trying to access admin endpoint
curl -X GET http://localhost:3004/admin/verifications/pending \
  -H "Authorization: Bearer {student_token}"
# Response: 403 Forbidden
```

#### 404 Not Found

```json
{
  "success": false,
  "message": "Not Found",
  "errors": ["User with ID 'invalid-id' not found"],
  "timestamp": "2025-11-13T18:20:00.000Z",
  "path": "/internal/users/invalid-id"
}
```

**cURL Example**:
```bash
curl -X GET http://localhost:3001/internal/users/non-existent-id \
  -H "Authorization: Bearer {service_token}"
# Response: 404 Not Found
```

#### 409 Conflict (Duplicate Resource)

```json
{
  "success": false,
  "message": "Conflict",
  "errors": ["User with email 'existing@example.com' already exists"],
  "timestamp": "2025-11-13T18:25:00.000Z",
  "path": "/internal/users"
}
```

**cURL Example**:
```bash
curl -X POST http://localhost:3001/internal/users \
  -H "Authorization: Bearer {service_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "existing@example.com",
    "firstName": "John",
    "lastName": "Doe"
  }'
# Response: 409 Conflict
```

#### 429 Too Many Requests (Rate Limit)

```json
{
  "success": false,
  "message": "Too Many Requests",
  "errors": ["Rate limit exceeded. Please try again in 60 seconds"],
  "timestamp": "2025-11-13T18:30:00.000Z",
  "path": "/users/me",
  "retryAfter": 60
}
```

#### 500 Internal Server Error

```json
{
  "success": false,
  "message": "Internal Server Error",
  "errors": ["An unexpected error occurred. Please try again later"],
  "timestamp": "2025-11-13T18:35:00.000Z",
  "path": "/users/me",
  "requestId": "req-uuid-789"
}
```

## API Versioning

### Current Version: v1

All APIs are currently version 1. Future versions will be introduced via URL path:

```bash
# Current (v1 - default)
GET /users/me

# Future (v2)
GET /v2/users/me
```

### Versioning Strategy

- **Breaking Changes**: Require new version (v2, v3, etc.)
- **Non-Breaking Changes**: Add to current version
- **Deprecation**: Minimum 6 months notice before removal

**Examples**:

**Breaking Change** (requires new version):
- Removing a field from response
- Changing field types
- Renaming endpoints

**Non-Breaking Change** (add to current version):
- Adding new optional fields
- Adding new endpoints
- Adding new optional query parameters

## Rate Limiting

### Public API Limits

| Endpoint Type        | Rate Limit          | Window  |
|----------------------|---------------------|---------|
| Authentication       | 10 requests         | 1 min   |
| Read Operations (GET)| 100 requests        | 1 min   |
| Write Operations     | 20 requests         | 1 min   |
| File Uploads         | 5 requests          | 1 min   |
| Search               | 30 requests         | 1 min   |

### Rate Limit Headers

```bash
X-RateLimit-Limit: 100        # Total requests allowed
X-RateLimit-Remaining: 95     # Requests remaining
X-RateLimit-Reset: 1699568400 # Unix timestamp when limit resets
```

### Rate Limit Example

```bash
curl -v http://localhost:3000/users/me \
  -H "Authorization: Bearer {token}"

# Response Headers:
# X-RateLimit-Limit: 100
# X-RateLimit-Remaining: 95
# X-RateLimit-Reset: 1699568400
```

### Exceeding Rate Limit

```bash
# After 100 requests in 1 minute
curl http://localhost:3000/users/me \
  -H "Authorization: Bearer {token}"

# Response: 429 Too Many Requests
{
  "success": false,
  "message": "Too Many Requests",
  "errors": ["Rate limit exceeded. Please try again in 45 seconds"],
  "retryAfter": 45
}
```

## Complete cURL Examples

### User Service Examples

#### Create User (Internal)

```bash
curl -X POST http://localhost:3001/internal/users \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "X-Service-Name: identity-service" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "student@example.com",
    "firstName": "John",
    "lastName": "Doe",
    "role": "student",
    "status": "active"
  }'
```

#### Get User Profile (Public)

```bash
curl -X GET http://localhost:3000/users/me \
  -H "Authorization: Bearer eyJraWQiOiJrZXktaWQiLCJhbGciOiJSUzI1NiJ9..."
```

#### Update User Profile (Public)

```bash
curl -X PUT http://localhost:3000/users/me \
  -H "Authorization: Bearer eyJraWQiOiJrZXktaWQiLCJhbGciOiJSUzI1NiJ9..." \
  -H "Content-Type: application/json" \
  -d '{
    "bio": "Mathematics and programming enthusiast",
    "skills": ["algebra", "python", "javascript"]
  }'
```

#### Become Tutor (Public)

```bash
curl -X POST http://localhost:3000/users/me/become-tutor \
  -H "Authorization: Bearer eyJraWQiOiJrZXktaWQiLCJhbGciOiJSUzI1NiJ9..." \
  -H "Content-Type: application/json" \
  -d '{
    "subjects": ["mathematics", "programming"],
    "bio": "10 years of teaching experience"
  }'
```

### Tutor Service Examples

#### Create Tutor Profile (Internal)

```bash
curl -X POST http://localhost:3003/internal/tutors \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "X-Service-Name: user-service" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user-123",
    "subjects": ["mathematics", "physics"],
    "hourlyRate": 50.00,
    "bio": "PhD in Mathematics with 10 years teaching experience"
  }'
```

#### Search Tutors (Public)

```bash
curl -X GET "http://localhost:3002/tutors/search?subject=mathematics&minRating=4.5&maxRate=60" \
  -H "Authorization: Bearer eyJraWQiOiJrZXktaWQiLCJhbGciOiJSUzI1NiJ9..."
```

#### Upload Tutor Document (Public)

```bash
curl -X POST http://localhost:3002/tutors/me/documents \
  -H "Authorization: Bearer eyJraWQiOiJrZXktaWQiLCJhbGciOiJSUzI1NiJ9..." \
  -F "file=@/path/to/certificate.pdf" \
  -F "documentType=certification" \
  -F "description=Teaching Certification"
```

### Admin Service Examples

#### Get Pending Verifications (Public)

```bash
curl -X GET "http://localhost:3004/admin/verifications/pending?type=tutor" \
  -H "Authorization: Bearer eyJraWQiOiJrZXktaWQiLCJhbGciOiJSUzI1NiJ9..." \
  -H "X-Admin-Role: admin"
```

#### Approve Tutor Verification (Public)

```bash
curl -X POST http://localhost:3004/admin/verifications/verification-123/approve \
  -H "Authorization: Bearer eyJraWQiOiJrZXktaWQiLCJhbGciOiJSUzI1NiJ9..." \
  -H "X-Admin-Role: admin" \
  -H "Content-Type: application/json" \
  -d '{
    "notes": "All documents verified successfully",
    "approvedDocuments": ["doc-456", "doc-457"]
  }'
```

#### Get Platform Analytics (Public)

```bash
curl -X GET "http://localhost:3004/admin/analytics?startDate=2025-11-01&endDate=2025-11-13" \
  -H "Authorization: Bearer eyJraWQiOiJrZXktaWQiLCJhbGciOiJSUzI1NiJ9..." \
  -H "X-Admin-Role: admin"
```

## Health Checks

All services expose health check endpoints:

```bash
# User Service
curl http://localhost:3000/health
curl http://localhost:3001/health

# Tutor Service
curl http://localhost:3002/health
curl http://localhost:3003/health

# Admin Service
curl http://localhost:3004/health
curl http://localhost:3005/health
```

**Response**:
```json
{
  "status": "OK",
  "timestamp": "2025-11-13T19:00:00.000Z",
  "service": "user-service",
  "version": "1.0.0",
  "environment": "development",
  "port": 3000,
  "features": {
    "database": "postgres",
    "cache": "redis",
    "auth": "cognito",
    "storage": "s3",
    "email": "enabled"
  },
  "checks": {
    "database": "connected",
    "cache": "connected"
  }
}
```

## Summary

This API documentation covers:

- **Dual-port architecture** for public and internal APIs
- **Authentication** via AWS Cognito (public) and service tokens (internal)
- **Complete API reference** for User, Tutor, and Admin services
- **Error handling** with consistent response format
- **Rate limiting** to protect services
- **cURL examples** for all endpoints
- **Versioning strategy** for future changes

All APIs follow REST principles and return JSON responses with consistent structure using the `@edtech/types` shared library.
